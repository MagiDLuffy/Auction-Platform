<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Profile</title>
      <link rel="stylesheet" href="/css/profile.css">
      <link rel="stylesheet" href="/css/styles.css">
  </head>
  <body>
      <div class="top-container">
        <i class="fa-solid fa-right-from-bracket" id="logout-icon" onclick="window.location.href='/auth/logout'"><span>Logout</span></i>
        <h1><%= user.name %>'s Profile</h1>
      </div>

      <div id="container">
          <!-- Sold Products Section -->
          <div id="sold">
              <h2>Sold Products</h2>
              <% if (soldProduct && soldProduct.length > 0) { %>
                  <% soldProduct.forEach(function(product) { %>
                      <div class="product">
                          <img src="<%= product.img %>" alt="<%= product.title || product.name %>">
                          <h3 class="name"><%= product.title || product.name %></h3>
                          <p>Price: <%= product.price %></p>
                          <p>Sold Price: <%= product.maxamount ? product.maxamount : "N/A" %></p>
                          <form action="/auction/<%= product._id %>?_method=PUT" method="post">
                            <button type="submit" id="upt-auction">Update Auction</button>
                          </form>
                          <form action="/auction/<%= product._id %>?_method=DELETE" method="post" onsubmit="return confirm('Do you want to delete the auction?');">
                            <button type="submit" id="dlt-auction">Delete Auction</button>
                          </form>
                      </div>
                  <% }); %>
              <% } else { %>
                  <p class="noProduct">No Product Sold</p>
              <% } %>
          </div>

          <!-- Active Auctions Section -->
          <div class="Bids">
              <h2>Active Auctions</h2>
              <% if (auction && auction.length > 0) { %>
                  <% auction.forEach(function(myBid) { %>
                      <div class="myBids">
                          <h3 class="bid"><%= myBid.title %></h3>
                          <img src="<%= myBid.img %>" alt="<%= myBid.title %>">
                          <p class="price">Starting Price: <%= myBid.price %></p>
                          <p class="maxBid">Highest Bid: <%= myBid.maxamount ? myBid.maxamount : "No bids yet" %></p>
                          <p class="endingTime">Ends at: <%= myBid.end_time ? myBid.end_time.toLocaleString() : "N/A" %></p>
                      </div>
                  <% }); %>
              <% } else { %>
                  <p class="NoBids">No active Auctions</p>
              <% } %>
          </div>

          <!-- Won Auctions Awaiting Payment -->
          <div class="won-section">
              <h2>Won Auctions - Awaiting Payment</h2>
              <% if (wonAuctions && wonAuctions.length > 0) { %>
                  <% wonAuctions.forEach(function(won) { %>
                      <div class="won-auction-card">
                          <h3><%= won.title %></h3>
                          <img src="<%= won.img %>" alt="<%= won.title %>">
                          <p class="price">Your Bid: $<%= won.maxamount %></p>
                          <p class="end-time">Ended on: <%= won.end_time.toLocaleString() %></p>
                          <form action="/auth/paymentPage" method="GET">
                            <input type="hidden" name="deadId" value="<%= won._id %>">
                            <button type="submit" class="payment-btn">Pay</button>
                          </form>
                        
                      </div>
                  <% }) %>
              <% } else { %>
                  <p class="no-wins">You haven't won any auctions yet.</p>
              <% } %>
          </div>
      </div>

      <script src="https://kit.fontawesome.com/10e51ef5e7.js" crossorigin="anonymous"></script>
  </body>
</html>
